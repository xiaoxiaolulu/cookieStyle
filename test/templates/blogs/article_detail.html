{% extends 'base.html' %}
{% load static %}
{% block title %}
  {{ article.title }} | {{ block.super }}
{% endblock %}
{% block css %}
  <link rel="stylesheet" href="{% static 'editormd_src\css\editormd.preview.css' %}">
{% endblock %}
{% block content %}
  <div class="container">
    <div class="row">
      <div class="col-md-8">
        <h3 class="text-center">{{ article.title|title }}</h3>
        <hr>
        <p class="text-left">
          <a href="{% url 'users:detail' article.user.username %}">{{ article.user.get_profile_name }}</a>
          发表于{{ article.created_at|date:"Y-m-d" }}
          {% if request.user.username == article.user.username %}
            &nbsp;&nbsp;|&nbsp;&nbsp;
            <a href="" title="编辑文章">
              <i class="fa fa-pencil-square-o" aria-hidden="true">编辑文本</i>
            </a>
          {% endif %}
          &nbsp;&nbsp;|&nbsp;&nbsp;
          <a href="#">收藏本文</a>
          &nbsp;&nbsp;|&nbsp;&nbsp;
          <a href="#">分享本文</a>
        </p>
        <hr>
        <div id="test-editormd-view">
          <label for="markdown-textarea"></label>
          <textarea name="test-editormd-markdown-doc" id="markdown-textarea" cols="30" rows="10" style="display: none">
            {{ article.content }}
          </textarea>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card my-2">
          <h6 class="card-header">文章目录</h6>
          <div class="card-body" style="padding: 8px" id="custom-toc-container"></div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
{% block modal %}
{% endblock %}
{% block js %}
  <script src="{% static 'editormd_src\examples\js\jquery.min.js' %}"></script>
  <script src="{% static 'editormd_src\lib\marked.min.js' %}"></script>
  <script src="{% static 'editormd_src\lib\prettify.min.js' %}"></script>
  <script src="{% static 'editormd_src\lib\raphael.min.js' %}"></script>
  <script src="{% static 'editormd_src\lib\underscore.min.js' %}"></script>
  <script src="{% static 'editormd_src\lib\sequence-diagram.min.js' %}"></script>
  <script src="{% static 'editormd_src\lib\flowchart.min.js' %}"></script>
  <script src="{% static 'editormd_src\lib\jquery.flowchart.min.js' %}"></script>
  <script src="{% static 'editormd_src\src\editormd.js' %}"></script>
  <script type="text/javascript">
    $(function () {
      let testEditormdView = editormd.markdownToHTML("test-editormd-view", {
                        markdown        : $("#markdown-textarea").text() ,//+ "\r\n" + $("#append-test").text(),
                        //htmlDecode      : true,       // 开启 HTML 标签解析，为了安全性，默认不开启
                        htmlDecode      : "style,script,iframe",  // you can filter tags decode
                        toc             : true,
                        {#tocm            : true,    // Using [TOCM]#}
                        tocContainer    : "#custom-toc-container", // 自定义 ToC 容器层
                        //gfm             : false,
                        tocDropdown     : true,
                        // markdownSourceCode : true, // 是否保留 Markdown 源码，即是否删除保存源码的 Textarea 标签
                        emoji           : true,
                        taskList        : true,
                        tex             : true,  // 默认不解析
                        flowChart       : true,  // 默认不解析
                        sequenceDiagram : true,  // 默认不解析
                    });
    })
  </script>
{% endblock %}
